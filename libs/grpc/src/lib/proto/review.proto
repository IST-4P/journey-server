syntax = "proto3";

import "user.proto";
import "device.proto";
import "rental.proto";
import "booking.proto";
import "vehicle.proto";

package review;

service ReviewService {
  // User operations
  rpc CreateReview (CreateReviewRequest) returns (ReviewResponse);
  rpc UpdateReview (UpdateReviewRequest) returns (ReviewResponse);
  rpc DeleteReview (DeleteReviewRequest) returns (DeleteReviewResponse);
  rpc GetMyReviews (GetMyReviewsRequest) returns (GetMyReviewsResponse);
  rpc GetReviewById (GetReviewByIdRequest) returns (ReviewResponse);
  
  // Public operations
  rpc GetReviewsByVehicle (GetReviewsByVehicleRequest) returns (GetReviewsResponse);
  rpc GetReviewsByDevice (GetReviewsByDeviceRequest) returns (GetReviewsResponse);
  rpc GetReviewsByCombo (GetReviewsByComboRequest) returns (GetReviewsResponse);
  
  // Rating statistics
  rpc GetVehicleRatingStats (GetRatingStatsRequest) returns (RatingStatsResponse);
  rpc GetDeviceRatingStats (GetRatingStatsRequest) returns (RatingStatsResponse);
  rpc GetComboRatingStats (GetRatingStatsRequest) returns (RatingStatsResponse);
  
  // Admin operations
  rpc GetAllReviews (GetAllReviewsRequest) returns (GetReviewsResponse);
  rpc AdminDeleteReview (AdminDeleteReviewRequest) returns (DeleteReviewResponse);
}

enum ReviewType {
  DEVICE = 0;
  VEHICLE = 1;
  COMBO = 2;
}

enum SortField {
  CREATED_AT = 0;
  UPDATED_AT = 1;
  RATING = 2;
  TITLE = 3;
}

enum SortOrder {
  ASCENDING = 0;
  DESCENDING = 1;
}

// Review entity 
message Review { 
  string id = 1;
  string bookingId = 2;
  string vehicleId = 3;
  string deviceId = 4;
  string comboId = 5;
  string userId = 6;

  int32 rating = 7;
  string title = 8;
  ReviewType type = 9;
  string content = 10;
  repeated string images = 11;

  string created_at = 12;
  string updated_at = 13;

  int32 update_count = 14;
  string rentalId = 15;
}

// Review summary (no content/images)
message ReviewSummary { 
  string id = 1;
  string bookingId = 2;
  string vehicleId = 3;
  string deviceId = 4;
  string comboId = 5;
  string userId = 6;

  int32 rating = 7;
  string title = 8;
  ReviewType type = 9;

  string created_at = 10;
  string updated_at = 11;

  int32 update_count = 12;
  string rentalId = 13;
}

// Request messages
message CreateReviewRequest {
  optional string bookingId = 1;
  string userId = 2; 
  optional string rentalId = 3;
  int32 rating = 4;
  string title = 5;
  ReviewType type = 6;
  string content = 7;
  repeated string images = 8;
}

message UpdateReviewRequest {
  string reviewId = 1;
  string userId = 2;
  
  int32 rating = 3;
  string title = 4;
  string content = 5;
  repeated string images = 6;
}

message DeleteReviewRequest {
  string reviewId = 1;
  string userId = 2;
}

message GetReviewByIdRequest {
  string reviewId = 1;
}

message GetMyReviewsRequest {
  string userId = 1;
  int32 page = 2;
  int32 limit = 3;
  
  // Query options
  optional string search_text = 4;
  optional int32 min_rating = 5;
  optional int32 max_rating = 6;
  optional string start_date = 7;  // ISO 8601 format
  optional string end_date = 8;    // ISO 8601 format
  optional SortField sort_by = 9;
  optional SortOrder sort_order = 10;
}

message GetReviewsByVehicleRequest {
  string vehicleId = 1;
  int32 page = 2;
  int32 limit = 3;
  
  // Query options
  optional string search_text = 4;
  optional int32 min_rating = 5;
  optional int32 max_rating = 6;
  optional string start_date = 7;
  optional string end_date = 8;
  optional SortField sort_by = 9;
  optional SortOrder sort_order = 10;
}

message GetReviewsByDeviceRequest {
  string deviceId = 1;
  int32 page = 2;
  int32 limit = 3;
  
  // Query options
  optional string search_text = 4;
  optional int32 min_rating = 5;
  optional int32 max_rating = 6;
  optional string start_date = 7;
  optional string end_date = 8;
  optional SortField sort_by = 9;
  optional SortOrder sort_order = 10;
}

message GetReviewsByComboRequest {
  string comboId = 1;
  int32 page = 2;
  int32 limit = 3;
  
  // Query options
  optional string search_text = 4;
  optional int32 min_rating = 5;
  optional int32 max_rating = 6;
  optional string start_date = 7;
  optional string end_date = 8;
  optional SortField sort_by = 9;
  optional SortOrder sort_order = 10;
}

message GetAllReviewsRequest {
  string adminId = 1;
  int32 page = 2;
  int32 limit = 3;
  ReviewType type = 4;
  
  // Query options
  string search_text = 5;
  int32 min_rating = 6;
  int32 max_rating = 7;
  string start_date = 8;
  string end_date = 9;
  SortField sort_by = 10;
  SortOrder sort_order = 11;
}

message AdminDeleteReviewRequest {
  string reviewId = 1;
  string adminId = 2;
}

// Response messages
message ReviewResponse {
  Review review = 1;
  string message = 2;
}

message GetReviewsResponse {
  repeated Review reviews = 1;
  int32 page = 2;
  int32 limit = 3;
  int32 total_items = 4;
  int32 total_pages = 5;
}

message GetMyReviewsResponse {
  repeated Review reviews = 1;
  int32 page = 2;
  int32 limit = 3;
  int32 total_items = 4;
  int32 total_pages = 5;
}

message DeleteReviewResponse {
  bool success = 1;
  string message = 2;
}

// Rating statistics message
message RatingStats {
  string targetId = 1;
  ReviewType type = 2;
  double averageRating = 3;
  int32 totalReviews = 4;
}

message GetRatingStatsRequest {
  string targetId = 1;
}

message RatingStatsResponse {
  RatingStats stats = 1;
  string message = 2;
}