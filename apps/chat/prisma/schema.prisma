generator client {
    provider      = "prisma-client-js"
    output        = "../../../node_modules/@prisma-clients/chat"
    binaryTargets = ["native", "debian-openssl-1.1.x"]
}

datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

enum ComplaintStatus {
    OPEN
    IN_PROGRESS
    RESOLVED
    CLOSED
}

enum ComplaintMessageType {
    TEXT
    IMAGE
}

model Chat {
    id         String   @id @default(uuid())
    fromUserId String
    toUserId   String
    content    String
    createdAt  DateTime @default(now())
}

model Complaint {
    id        String             @id @default(uuid())
    userId    String
    title     String
    status    ComplaintStatus    @default(OPEN)
    createdAt DateTime           @default(now())
    updatedAt DateTime           @updatedAt
    messages  ComplaintMessage[]

    @@index([userId])
    @@index([status])
}

model ComplaintMessage {
    id          String               @id @default(uuid())
    complaintId String
    senderId    String
    messageType ComplaintMessageType
    content     String // Text content hoáº·c image URL
    createdAt   DateTime             @default(now())
    complaint   Complaint            @relation(fields: [complaintId], references: [id], onDelete: Cascade)

    @@index([complaintId])
    @@index([senderId])
}
